run:
  - replace:
     filename: "/etc/nginx/conf.d/discourse.conf"
     global: true
     from: /server.+{/
     to: |
       server {
         error_page 502 /error_page.html;
         location /error_page.html {
           root /var/www/discourse-offline-page/html;
           internal;
         }
         location /error-page.png {
           root /var/www/discourse-offline-page/html;
         }
         location /error-page-dark.png {
           root /var/www/discourse-offline-page/html;
         }
         location /error-page-bg.png {
           root /var/www/discourse-offline-page/html;
         }
         location /error-page-favicon.png {
           root /var/www/discourse-offline-page/html;
         }

  - exec:
      cmd: git clone https://github.com/discourse/discourse-offline-page.git /var/www/discourse-offline-page
      raise_on_fail: false
